# Step 1: 藏干與五行統計

## 任務

計算各柱藏干並統計五行分布。此步驟為純計算，**必須使用 bazi_engine 的輸出**。

## 輸入

```
前一步輸出: {step0_output}
```

## 處理流程

1. 讀取 bazi_engine 的 step1.藏干 資料
2. 讀取 bazi_engine 的 step2 五行統計資料
3. 整理藏干的本氣、中氣、餘氣及權重
4. 記錄五行的強弱與缺失

## 輸出格式 (JSON)

```json
{
  "step": 1,
  "task": "藏干與五行統計",
  "藏干": {
    "年支": [
      {"stem": "X", "role": "本氣", "weight": 1.0, "wuxing": "X"}
    ],
    "月支": [],
    "日支": [],
    "時支": []
  },
  "五行統計": {
    "counts": {"金": 0.0, "木": 0.0, "水": 0.0, "火": 0.0, "土": 0.0},
    "detail": {
      "天干": {"金": 0, "木": 0, "水": 0, "火": 0, "土": 0},
      "地支": {"金": 0, "木": 0, "水": 0, "火": 0, "土": 0},
      "藏干": {"金": 0.0, "木": 0.0, "水": 0.0, "火": 0.0, "土": 0.0}
    },
    "missing": [],
    "dominant": "X"
  },
  "observations": [
    "年支 X 藏 Y（本氣）",
    "五行以 Z 最旺",
    "五行缺 W"
  ],
  "applied_rules": [],
  "confidence": 1.0,
  "engine_source": "bazi_engine.step1 + step2"
}
```

## 規則

### 必須遵守

1. **禁止自行計算藏干** — 必須使用 bazi_engine 的 DIZHI_CANGGAN 定義
2. **禁止自行計算五行統計** — 必須使用 bazi_engine.compute_five_elements() 輸出
3. **confidence 固定為 1.0** — 藏干與五行為確定性計算

### 藏干權重標準

| 類型 | 權重 |
|------|------|
| 本氣 | 1.0 |
| 中氣 | 0.5 |
| 餘氣 | 0.3 |

### observations 撰寫規範

只描述結構性事實，不做解讀：

- ✅ "五行以木最旺（6.0）"
- ✅ "五行缺金"
- ✅ "月支寅藏甲木（本氣）、丙火（中氣）、戊土（餘氣）"
- ❌ "木旺則肝氣過盛"（這是解讀）
- ❌ "缺金不利呼吸系統"（這是解讀）

## 禁止事項

- ❌ 禁止從案例故事反推規則
- ❌ 禁止在 observations 中加入任何吉凶判斷
- ❌ 禁止引用 rules/ 目錄外的規則
- ❌ 禁止修改 bazi_engine 的計算結果
